<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Options</title>
    </head>

    <body onload="showUserAttributes()">
        <label><h2>PÃ¡gina de Boas Vindas:</h2></label>
        <h3>Role: <span id="role"></span></h3>
        <input type="button" value="Logout" onclick="logout();">
        <p></p>

        <div id="list"></div>

        <label>Remover Utilizador:</label>
        <input type="button" value="Remover" onclick="window.location.href = 'deleteUser.html'">
        <p></p>

        <label>Listar Utilizadores:</label>
        <input type="button" value="Listar" onclick="window.location.href = 'listUsers.html'">
        <p></p>

        <label>Modificar atributos de um User:</label>
        <input type="button" value="Modificar" onclick="window.location.href = 'modifyUsers.html'">
        <p></p>

        <label>Modificar password:</label>
        <input type="button" value="Modificar Pass" onclick="window.location.href = 'modifyPass.html'">
        <p></p>

        <label>Mostrar token:</label>
        <input type="button" value="Mostrar" onclick="showToken();">
        <p></p>

        <label>Registar propriedade:</label>
        <input type="button" value="Registar" onclick="window.location.href = 'registerProperty.html'">
        <p></p>

        <label>Listar propriedade:</label>
        <input type="button" value="Listar" onclick="window.location.href = 'searchProperty.html'">
        <p></p>

    </body>

    <script>
         let token = sessionStorage.getItem('token');
         if(token == null) {
            window.location.href = 'index.html';
         }

         let json = JSON.parse(token);
         document.getElementById("role").innerText = json.role;


         function logout() {
            sessionStorage.removeItem('token');
             window.location.href = 'logout.html';
         }


         function showUserAttributes() {
             xmlhttp = new XMLHttpRequest();

             xmlhttp.onreadystatechange = function (){
                 if(xmlhttp.readyState == 4){
                     const obj = JSON.parse(xmlhttp.responseText);
                     document.getElementById("list").innerHTML = null;
                     for(let i = 0; i<obj.length; i++){
                         document.getElementById("list").innerHTML += Object.values(obj[i]) + "<br />";
                     }
                     alert(xmlhttp.responseText);
                 }
             }

             let token = JSON.parse(sessionStorage.getItem('token'));
             var myObj = {
                 username: token.username,
                 validTo: token.validTo,
                 verifier: token.verifier
             };
             var myJson = JSON.stringify(myObj);


             xmlhttp.open("POST", "https://central-diode-349523.ew.r.appspot.com/rest/ti/showUserAttributes", true);
             xmlhttp.setRequestHeader("Content-Type", "application/json");
             xmlhttp.send(myJson);
         }


         function showToken() {
             alert(sessionStorage.getItem('token'));
         }

    </script>
</html>